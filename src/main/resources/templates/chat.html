<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title>Chat</title>
    <style>.chat-message { margin-bottom: 10px; } .sent { text-align: right; } .received { text-align: left; }</style>
</head>
<body>
<div layout:fragment="content">
    <h2 th:text="|Chat with ${recipient.email}|"></h2>
    <div class="card">
        <div class="card-body" style="height: 400px; overflow-y: scroll;">
            <div th:each="msg : ${messages}" class="chat-message" th:classappend="${msg.sender.id == currentUser.id} ? 'sent' : 'received'"><div class="alert" th:classappend="${msg.sender.id == currentUser.id} ? 'alert-primary' : 'alert-secondary'"><strong th:text="${msg.sender.email}"></strong>: <span th:text="${msg.content}"></span><div class="small text-muted" th:text="${#temporals.format(msg.timestamp, 'MMM dd, HH:mm')}"></div></div></div>
        </div>
        <div class="card-footer">
            <form th:action="@{/chat/send}" method="post">
                <input type="hidden" name="recipientId" th:value="${recipient.id}" />
                <div class="input-group"><input type="text" name="content" class="form-control" placeholder="Type a message..." required/><div class="input-group-append"><button class="btn btn-primary" type="submit">Send</button></div></div>
            </form>
        </div>
    </div>
</div>
</body>
</html>
